<nav class="sticky top-0 z-50 bg-gradient-to-r from-coffee to-violet shadow-lg relative z-30" data-controller="mobile-menu dropdown">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex justify-between items-center h-16">
      <!-- Logo -->
      <%= link_to root_path, class: "text-white font-bold text-xl hover:text-yellow-600 transition-colors flex-shrink-0" do %>
        myCards
      <% end %>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-6 flex-1 justify-center">
        <%= link_to "Browse Sets", sets_path, class: "text-gray-200 hover:text-white transition-colors" %>

        <% if Current.user %>
          <%= link_to "My Collection", collection_cards_path, class: "text-gray-200 hover:text-white transition-colors" %>
        <% end %>
      </div>

      <!-- Desktop Search -->
      <% if show_navbar_search? %>
        <div class="hidden md:block flex-1 max-w-md mx-6">
          <div data-controller="autocomplete" class="relative">
            <%= form_with url: search_cards_path, method: :get, data: { turbo: false } do |f| %>
              <%= f.text_field :q,
                  placeholder: "Search cards...",
                  autocomplete: "off",
                  class: "w-full px-4 py-2 rounded-lg text-gray-900 bg-white/90 focus:bg-white focus:outline-none focus:ring-2 focus:ring-yellow-600 text-sm",
                  data: {
                    autocomplete_target: "input",
                    action: "input->autocomplete#search keydown.enter->autocomplete#submit"
                  } %>
              <div data-autocomplete-target="results"
                  class="hidden absolute z-20 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto mt-2">
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Desktop Auth -->
      <div class="hidden md:flex items-center gap-4 flex-shrink-0">
        <% if Current.user %>
          <div class="relative">
            <button data-action="click->dropdown#toggle"
                    class="flex items-center gap-2 text-gray-200 hover:text-goldenrod transition-colors cursor-pointer">
              <span><%= Current.user.email_address.split('@').first %></span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>

            <div data-dropdown-target="menu"
                 class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-50">
              <%= link_to "My Collection", collection_cards_path, class: "block px-4 py-2 text-gray-700 hover:bg-gray-100" %>
              <hr class="my-1">
              <%= button_to "Sign Out", session_path, method: :delete,
                  class: "w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer",
                  form_class: "w-full" %>
            </div>
          </div>
        <% else %>
          <%= link_to "Sign In", new_session_path, class: "text-gray-200 hover:text-white transition-colors" %>
          <%= link_to "Sign Up", new_registration_path, class: "bg-yellow-800 text-white px-4 py-2 rounded-lg font-semibold hover:bg-yellow-700 transition-colors" %>
        <% end %>
      </div>

      <!-- Mobile Hamburger Button -->
      <button data-action="click->mobile-menu#toggle"
              class="md:hidden text-white p-2 cursor-pointer">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path data-mobile-menu-target="open" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          <path data-mobile-menu-target="close" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div data-mobile-menu-target="menu" class="hidden md:hidden pb-4">
      <div class="space-y-3">
        <!-- Mobile Search -->
        <% if show_navbar_search? %>
          <div data-controller="autocomplete" class="relative">
            <%= form_with url: search_cards_path, method: :get, data: { turbo: false } do |f| %>
              <%= f.text_field :q,
                  placeholder: "Search cards...",
                  autocomplete: "off",
                  class: "w-full px-4 py-2 rounded-lg text-gray-900 bg-white focus:outline-none focus:ring-2 focus:ring-yellow-600",
                  data: {
                    autocomplete_target: "input",
                    action: "input->autocomplete#search keydown.enter->autocomplete#submit"
                  } %>
              <div data-autocomplete-target="results"
                  class="hidden absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto mt-2">
              </div>
            <% end %>
          </div>
        <% end %>

        <%= link_to "Browse Sets", sets_path, class: "block text-gray-200 hover:text-white py-2" %>

        <% if Current.user %>
          <%= link_to "My Collection", collection_cards_path, class: "block text-gray-200 hover:text-white py-2" %>
          <hr class="border-gray-600">
          <%= button_to "Sign Out", session_path, method: :delete,
              class: "w-full text-left text-gray-200 hover:text-white py-2 bg-transparent border-none cursor-pointer" %>
        <% else %>
          <%= link_to "Sign In", new_session_path, class: "block text-gray-200 hover:text-white py-2" %>
          <%= link_to "Sign Up", new_registration_path, class: "block bg-yellow-800 text-white px-4 py-2 rounded-lg font-semibold text-center mt-2" %>
        <% end %>
      </div>
    </div>
  </div>
</nav>
